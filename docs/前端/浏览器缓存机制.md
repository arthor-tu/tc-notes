# 浏览器缓存机制

## 什么是浏览器缓存

浏览器缓存Brower Caching是浏览器对之前请求过的文件进行缓存，以便再次访问的时候提高页面展示的速度。

## 为什么需要缓存？缓存有哪些优势？

- 浏览器缓存是将文件保存在客户端，减少重复请求浪费网络带宽，只产生很小的网络消耗。

ps：打开本地资源也会产生网络消耗

- 缓解服务器的压力，不用重复请求数据

- 提升前端性能，提高访问速度，提供更好的用户体验

## 缓存的类别

### 数据库缓存

将查询后的数据放在内存中进行缓存，下次再查询，直接从内存缓存中获取，提高响应速度

### CDN缓存

发送web请求，cdn计算出路径短且快的路。管理员部署，把经常访问的放入cnd加快响应

### 代理服务器缓存

与浏览器缓存机制类似，但代理服务器面向更广大的群体，规模更大。不只是为一个用户服务，而是为一群用户服务。

### HTTP缓存

每个浏览器都实现HTTP缓存。浏览器使用HTTP协议与服务器交互，根据与服务器约定的规则进行缓存工作

## 缓存的位置

### Server Worker

Server Worker 是运行在浏览器的独立线程，一般用来缓存。Server Worker 涉及请求拦截，so传输协议是HTTPS来保障安全。

Server Worker 是“外建”的缓存机制，可以自由控制缓存哪些文件、如何匹配缓存、如何读取缓存，并且缓存是持续性的，这是与其他内建缓存机制的区别。

### Memory Cache

内存中的缓存，主要包含的是当前中页面中已经抓取到的资源，例如页面上已经下载的样式、脚本、图片等，占据该进程一定的内存资源，但是缓存持续性很短，会随着进程的释放而释放。一旦我们关闭 Tab 页面，内存中的缓存也就被释放了。

内存缓存特点：

- 读取速度快
- 时效性：页面关闭进程 的内存清空释放

### Disk Cache

硬盘中的缓存。在所有浏览器缓存中，Disk Cache 覆盖面基本是最大的，绝大部分的缓存都来自 Disk Cache。为什么呢？cuz根据 HTTP Herder 中的字段判断哪些资源需要缓存，哪些资源可以不请求直接使用，哪些资源已经过期需要重新请求。在跨站点的情况下，相同地址的资源一旦被硬盘缓存下来，就不会再次去请求数据。

硬盘缓存比内存缓存读取速度慢，读取需要对硬盘进行I/O操作，会导致重新解析缓存内容，造成读取路的复杂。

### Push Cache

推送缓存，是HTTP/2的内容，并没有严格执行HTTP头部的缓存指令。在Server Worker、Memory Cache、Disk Cache都没有命中的时候，它会被使用。在Session中存在，Session结束就会被释放，缓存时间短暂。

### 其它相关问题

- Memory Cache 和 Disk Cache的相同和不同比较

|          | Memory Cache | Disk Cache|
| -------- | --- | --- |
| 相同点    | 只能存储一些派生类资源文件 | 只能存储一些派生类资源文件|
| 不同点    | 退出Tag进程时数据会被清除| 退出Tag进程时数据不会被清除 |
| 存储资源  | 一般脚本、图片、字体 | 一般非脚本css等|

## 缓存过程

- 强缓存
- 协商缓存

## 缓存相关配置

- Expires：http1.0规范，它设置一个值绝对时间的GMT格式的时间字符串，这个是资源失效时间（客户端的时间小于Expires的值），在这个时间之前都是名中缓存。
- Cache-Control：http1.1规范，替代Expires，它利用的是相对时间，利用header信息字段的max-age值判断。
  - max-age：代表资源的有效期是多少毫秒
  - public：可以被所有的用户缓存，包括终端用户和 CDN 等中间代理服务器
  - private： 只能被终端用户缓存，不允许CDN等中间缓存器对其缓存（默认取值）
  - no-cache：客户端缓存，发送请求到服务器确实是否使用协商
  - no-store：禁止缓存，级禁止强缓存和协商缓存，每次都需要重新请求数据
  - max-age：缓存内容有效时间

## 其它

### 怎么关闭web缓存？

## 参考文章

- [【一文就够】浏览器缓存机制详细知识点梳理](https://www.ngui.cc/zz/1652860.html?action=onClick)
